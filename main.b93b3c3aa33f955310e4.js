webpackJsonp([1],{160:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.perc2color=function(e){var t,a;e<50?(t=255,a=Math.round(5.1*e)):(a=255,t=Math.round(510-5.1*e));return"#"+("000000"+(65536*t+256*a+0).toString(16)).slice(-6)}},199:function(e,t,a){"use strict";var r=o(a(0)),n=o(a(14));a(204);var s=o(a(215));function o(e){return e&&e.__esModule?e:{default:e}}n.default.render(r.default.createElement(s.default,null),document.getElementById("app"))},204:function(e,t){},215:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},n=a(0),s=m(n),o=a(216),l=a(61),i=a(50),u=m(a(415)),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(a(434)),p=a(161),d=a(160);function m(e){return e&&e.__esModule?e:{default:e}}const f={northEast:{lat:80,lng:179.9},southWest:{lat:-80,lng:-179.9}};t.default=class extends n.Component{constructor(...e){var t;return t=super(...e),this.state={markersData:null,rectsData:null,bounds:null,minTemp:null,maxTemp:null,errorDialogIsOpen:!1},this.saveCurrentBounds=(e=>this.setState({bounds:e})),this.request=(async e=>{const t="VISIBLE_BBOX"===e?this.state.bounds:f;try{const e=await u.default.getWeatherPointsForBBox(t);this.setState({markersData:e});const a={gridType:"square",property:"temperature",units:"kilometers",weight:3};setTimeout(()=>{const t=c.interpolate(e,this.calcCellSize(e),a),[n,s]=this.getTempBounds(t.features),o=(0,p.scaleLinear)().domain([n,s]).range([0,100]);t.features=t.features.map(e=>r({},e,{properties:{color:(0,d.perc2color)(100-o(e.properties.temperature))}})),this.setState({rectsData:t,maxTemp:s,minTemp:n})},100)}catch(e){this.setState({errorDialogIsOpen:!0})}}),this.getTempBounds=(e=>{let t=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY;for(let r=0,n=e.length;r<n;r++){let n=e[r].properties.temperature;n>t&&(t=n),n<a&&(a=n)}return[a,t]}),t}render(){const{minTemp:e,maxTemp:t}=this.state;return s.default.createElement(s.default.Fragment,null,s.default.createElement(o.RequestButton,{onRequest:this.request}),null!=e&&null!=t&&s.default.createElement(o.TempLegend,{minTemp:e,maxTemp:t}),s.default.createElement(o.Map,{markersData:this.state.markersData,rectsData:this.state.rectsData,onBoundsChange:this.saveCurrentBounds}),s.default.createElement(l.Dialog,{icon:i.IconNames.ERROR,onClose:()=>this.setState({errorDialogIsOpen:!1}),title:"Ошибка",isOpen:this.state.errorDialogIsOpen,canEscapeKeyClose:!0,usePortal:!0,portalClassName:"movedToFront"},s.default.createElement("div",{className:l.Classes.DIALOG_BODY},s.default.createElement("p",null,"Не удалось загрузить данные, попробуйте повторить через минуту."))))}calcCellSize(e){return c.distance(e.features[0],e.features[1],{units:"kilometers"})/12}}},216:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(217);Object.defineProperty(t,"Map",{enumerable:!0,get:function(){return o(r).default}});var n=a(221);Object.defineProperty(t,"RequestButton",{enumerable:!0,get:function(){return o(n).default}});var s=a(347);function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"TempLegend",{enumerable:!0,get:function(){return o(s).default}})},217:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},n=i(a(0)),s=i(a(218)),o=i(a(219)),l=i(a(94));function i(e){return e&&e.__esModule?e:{default:e}}t.default=class extends n.default.Component{constructor(...e){var t;return t=super(...e),this.mapElementRef=n.default.createRef(),this.markers=[],this.rects=null,this.onMoveStart=(()=>{}),this.onMoveEnd=(()=>this.handleBoundsUpdate()),this.onResize=(()=>this.handleBoundsUpdate()),this.handleBoundsUpdate=(()=>{if("function"==typeof this.props.onBoundsChange){const e=this.map.getBounds();let{lat:t,lng:a}=e.getNorthEast();const r={lat:t,lng:a};({lat:t,lng:a}=e.getSouthWest());const n={lat:t,lng:a};this.props.onBoundsChange({northEast:r,southWest:n})}}),t}render(){return n.default.createElement("div",{className:s.default.map,ref:this.mapElementRef})}componentDidMount(){this.createMap(this.mapElementRef.current)}componentWillUnmount(){this.map.off("moveend"),this.map.off("movestart"),this.map.off("resize")}componentDidUpdate(e){this.props.markersData&&(this.props.markersData,e.markersData),this.props.rectsData&&this.props.rectsData!==e.rectsData&&this.placeRects(this.props.rectsData)}placeMarkers(e){this.markers.forEach(e=>this.map.removeLayer(e)),this.markers=[];const t=this.map.getCenter().lng,a={icon:new o.default.HtmlIcon({html:`<div class="${s.default.marker}"></div>`})};e.features.forEach(e=>{const[r,n]=e.geometry.coordinates,s=o.default.marker([n,o.default.Util.wrapNum(r,[-180+t,180+t],!0)],a);this.map.addLayer(s),this.markers.push(s)})}placeRects(e){this.rects&&this.map.removeLayer(this.rects),this.rects=o.default.geoJSON(e,{style:function(e){return{fillColor:e.properties.color,fillOpacity:.6,opacity:0}}}),this.map.addLayer(this.rects)}createMap(e){this.map=o.default.map(e,r({},l.default.map.initialOptions,{renderer:o.default.canvas()})),o.default.tileLayer(l.default.map.tileLayer.tilesSource,l.default.map.tileLayer.initialOptions).addTo(this.map),this.map.on("moveend",this.onMoveEnd),this.map.on("movestart",this.onMoveStart),this.map.on("resize",this.onResize),this.handleBoundsUpdate()}},o.default.HtmlIcon=o.default.Icon.extend({options:{},initialize:function(e){o.default.Util.setOptions(this,e)},createIcon:function(){var e=document.createElement("div");return e.innerHTML=this.options.html,e},createShadow:function(){return null}})},218:function(e,t){e.exports={map:"map_7urVK",marker:"marker_1S073"}},220:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={api:({lat:e,lng:t})=>`https://api.openweathermap.org/data/2.5/weather?lat=${e}&lon=${t}&APPID=3794c3f5df42da1f9672d29116d0bf56&units=metric`,map:{initialOptions:{center:[55,37],zoom:7,zoomAnimation:!0,zoomControl:!1},tileLayer:{tilesSource:"http://a.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",initialOptions:{attribution:'Map data &copy; <a href="http://osm.org">OpenStreetMap</a> contributors | <a href="https://www.hotosm.org/updates/2013-09-29_a_new_window_on_openstreetmap_data" title="Couche humanitaire par Yohan Boniface et HOT" target="_blank"><b><nobr>Y. Boniface</nobr> &amp; HOT</b></a> | <a href="https://www.openstreetmap.fr/mentions-legales/" title="OpenStreetMap France - mentions légales" target="_blank"><b>OSM France</b></a>',maxZoom:18,detectRetina:!1,updateWhenZooming:!1,updateWhenIdle:!0,reuseTiles:!0}}}}},221:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(0),n=u(r),s=a(61),o=a(50),l=a(287),i=u(a(346));function u(e){return e&&e.__esModule?e:{default:e}}const c=[{label:"60 точек равномерно по текущему bbox",requestType:"VISIBLE_BBOX"}],p=(e,{handleClick:t,modifiers:a,query:r})=>n.default.createElement(s.MenuItem,{active:a.active,disabled:a.disabled,key:e.requestType,onClick:t,text:e.label.toString()});t.default=(e=>{const[t,a]=(0,r.useState)(c[0]);return n.default.createElement("div",{className:i.default.wrapper},n.default.createElement(l.Select,{filterable:!1,items:c,onItemSelect:a,itemRenderer:p,popoverProps:{minimal:!0,usePortal:!1}},n.default.createElement(s.Button,{text:t.label,rightIcon:o.IconNames.CARET_DOWN,className:s.Classes.LARGE})),n.default.createElement(s.Button,{type:"button",intent:"primary",icon:o.IconNames.DOWNLOAD,className:s.Classes.LARGE,onClick:()=>e.onRequest(t.requestType),text:"Показать температуру"}))})},346:function(e,t){e.exports={wrapper:"wrapper_4NHYI"}},347:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=l(a(0)),n=l(a(348)),s=a(160),o=a(161);function l(e){return e&&e.__esModule?e:{default:e}}t.default=(e=>{const t=[];for(let e=0;e<=50;e++)t.push(r.default.createElement("div",{key:e,style:{backgroundColor:(0,s.perc2color)(100-100*e/50)}}));const a=[],l=(0,o.scaleLinear)().domain([0,100]).range([e.minTemp,e.maxTemp]);for(let e=0;e<=5;e++)a.push(r.default.createElement("div",{key:e,className:n.default.tick},r.default.createElement("div",{className:n.default.text},l(100*e/5).toFixed(1))));return r.default.createElement("div",{className:n.default.wrapper},r.default.createElement("div",{className:n.default.scale},t),r.default.createElement("div",{className:n.default.ticks},a))})},348:function(e,t){e.exports={wrapper:"wrapper_KPRWe",scale:"scale_3RUAd",ticks:"ticks_1qz3r",tick:"tick_2MOhY",text:"text_JAvWi"}},415:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},n=o(a(94)),s=o(a(416));function o(e){return e&&e.__esModule?e:{default:e}}const l={async getWeatherPointsForBBox({northEast:e,southWest:t}){const a=((e,t,a,r)=>{const n=Math.min(e,a),s=Math.max(e,a),o=Math.min(t,r),l=Math.max(t,r),i=Math.abs((s-n)/5),u=Math.abs((l-o)/9),c=[];for(let e=0;e<6;e++)for(let t=0;t<10;t++)c.push({lat:n+i*e,lng:o+u*t});return c})(t.lat,t.lng,e.lat,e.lng),o=await Promise.all(a.map(e=>s.default.get(n.default.api(e))));if(o.some(e=>200!==e.status||!e.data||200===!e.data.cod||!e.data.main||Number.isFinite(!e.data.main.temp)))throw"RETRY";return{type:"FeatureCollection",features:a.map((e,t)=>r({},e,{temp:o[t].data.main.temp})).map(e=>({type:"Feature",geometry:{type:"Point",coordinates:[e.lng,e.lat]},properties:{temperature:e.temp}}))}}};t.default=l},94:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e&&e.__esModule?e:{default:e}}(a(220));t.default=r.default}},[199]);